{% extends "layout.html" %}

{% block title %}Industrial Dashboard | DR-MITAMBO PRO{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    :root { 
        --cat: #FFCD00; 
        --neon: #00ffcc;
        --bg: #050505; 
        --card-bg: rgba(15, 15, 15, 0.95);
        --border-color: rgba(255, 255, 255, 0.08);
    }

    body { background-color: var(--bg); }

    /* Container adjustments */
    .dashboard-wrapper { padding: 10px; max-width: 1400px; margin: auto; }

    /* Glassmorphism Stat Cards */
    .stat-panel {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 15px;
        padding: 20px;
        position: relative;
        overflow: hidden;
        transition: 0.3s;
    }
    .stat-panel::before {
        content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 2px;
        background: linear-gradient(90deg, transparent, var(--neon), transparent);
        opacity: 0; transition: 0.5s;
    }
    .stat-panel:hover::before { opacity: 1; }
    .stat-panel:hover { border-color: rgba(0, 255, 204, 0.3); transform: translateY(-3px); }

    /* Industrial Module Grid (Marekebisho ya kadi mbili-mbili) */
    .module-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* Lazima mbili kwa upana */
        gap: 15px;
        margin-top: 25px;
    }

    @media (min-width: 992px) {
        .module-grid { grid-template-columns: repeat(4, 1fr); }
    }

    .module-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 18px;
        padding: 22px;
        text-decoration: none !important;
        transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        min-height: 140px;
    }

    .module-card:hover {
        background: rgba(255, 205, 0, 0.03);
        border-color: var(--cat);
        box-shadow: 0 15px 30px rgba(0,0,0,0.5);
        transform: scale(1.03);
    }

    .module-card i { font-size: 1.8rem; margin-bottom: 15px; transition: 0.3s; }
    .module-card:hover i { transform: scale(1.2) rotate(-10deg); filter: drop-shadow(0 0 8px currentColor); }

    .module-card h6 { 
        color: #ffffff; font-weight: 800; font-size: 0.95rem; margin-bottom: 5px; 
        text-transform: uppercase; letter-spacing: 0.5px;
    }
    .module-card p { color: #777; font-size: 0.75rem; margin: 0; line-height: 1.3; }

    /* Charts & Tables */
    .industrial-box {
        background: #0a0a0a;
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 25px;
        margin-top: 25px;
    }

    .status-indicator {
        width: 8px; height: 8px; border-radius: 50%; display: inline-block;
        margin-right: 5px; animation: blink 1.5s infinite;
    }
    @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

    /* Custom Table Style */
    .pro-table { color: #aaa; font-size: 0.8rem; }
    .pro-table thead { color: var(--cat); background: rgba(255, 205, 0, 0.05); }
    .pro-table td { vertical-align: middle; border-color: #1a1a1a; padding: 12px; }

</style>
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
    
    <div class="d-flex justify-content-between align-items-end mb-4">
        <div>
            <h2 class="brand-font text-white fw-bold mb-0">OPERATIONS <span class="text-warning">CENTER</span></h2>
            <p class="small text-muted mb-0">
                <span class="status-indicator" style="background: var(--neon);"></span> 
                System v10.4: Online | Fleet Telemetry: Active
            </p>
        </div>
        <div class="text-end d-none d-md-block">
            <small class="text-muted d-block">Operator Access</small>
            <span class="badge bg-dark border border-warning text-warning px-3 py-2">PRO MASTER</span>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-6 col-md-3">
            <div class="stat-panel">
                <small class="text-muted text-uppercase x-small">Fleet Availability</small>
                <h3 class="fw-bold text-success mb-0">94.8%</h3>
                <div class="progress mt-2" style="height: 3px; background: #1a1a1a;">
                    <div class="progress-bar bg-success" style="width: 94%"></div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-panel">
                <small class="text-muted text-uppercase x-small">Fuel Consumption</small>
                <h3 class="fw-bold text-warning mb-0">12.4 L/h</h3>
                <small class="text-muted x-small">+2.1% from avg</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-panel">
                <small class="text-muted text-uppercase x-small">Critical Faults</small>
                <h3 class="fw-bold text-danger mb-0">02</h3>
                <small class="text-muted x-small">Check Alerts Center</small>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="stat-panel">
                <small class="text-muted text-uppercase x-small">Service Revenue</small>
                <h3 class="fw-bold text-white mb-0">2.4M</h3>
                <small class="text-muted x-small">Current Quarter</small>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-lg-8">
            <div class="industrial-box shadow">
                <h6 class="text-muted small fw-bold mb-4 text-uppercase">Fleet Productivity (Engine Hours vs Target)</h6>
                <canvas id="mainChart" height="220"></canvas>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="industrial-box shadow h-100">
                <h6 class="text-muted small fw-bold mb-4 text-uppercase">Diagnostic Distribution</h6>
                <canvas id="healthChart" height="280"></canvas>
            </div>
        </div>
    </div>

    <h5 class="brand-font text-warning mt-5 mb-3 px-2" style="font-size: 1.1rem;">CONTROL MODULES</h5>
    <div class="module-grid">
        <a href="{{ url_for('diagnosis') }}" class="module-card">
            <i class="fas fa-robot text-info"></i>
            <div>
                <h6>AI Diagnosis</h6>
                <p>Uchambuzi wa hitilafu.</p>
            </div>
        </a>

        <a href="{{ url_for('electrical') }}" class="module-card">
            <i class="fas fa-bolt text-warning"></i>
            <div>
                <h6>Electrical Hub</h6>
                <p>Wiring & Sensor Analysis.</p>
            </div>
        </a>

        <a href="{{ url_for('systems_op') }}" class="module-card">
            <i class="fas fa-microchip text-primary"></i>
            <div>
                <h6>Systems Op</h6>
                <p>Hydraulic & Engine Logic.</p>
            </div>
        </a>

        <a href="{{ url_for('troubleshooting') }}" class="module-card">
            <i class="fas fa-screwdriver-wrench text-secondary"></i>
            <div>
                <h6>Troubleshoot</h6>
                <p>Miongozo ya kurekebisha.</p>
            </div>
        </a>

        <a href="{{ url_for('maintenance') }}" class="module-card">
            <i class="fas fa-calendar-alt text-success"></i>
            <div>
                <h6>Maintenance</h6>
                <p>Service & Fleet tracking.</p>
            </div>
        </a>

        <a href="{{ url_for('parts') }}" class="module-card">
            <i class="fas fa-gears text-danger"></i>
            <div>
                <h6>Parts Book</h6>
                <p>Catalog ya vipuri.</p>
            </div>
        </a>

        <a href="{{ url_for('manuals') }}" class="module-card">
            <i class="fas fa-book text-info"></i>
            <div>
                <h6>Manuals</h6>
                <p>Service & Repair manuals.</p>
            </div>
        </a>

        <a href="{{ url_for('schematics') }}" class="module-card">
            <i class="fas fa-project-diagram text-warning"></i>
            <div>
                <h6>Schematics</h6>
                <p>Wiring & hydraulic diagrams.</p>
            </div>
        </a>

        <a href="{{ url_for('fleet') }}" class="module-card">
            <i class="fas fa-truck-moving text-primary"></i>
            <div>
                <h6>My Fleet</h6>
                <p>Orodha ya mitambo yote.</p>
            </div>
        </a>

        <a href="{{ url_for('reports') }}" class="module-card">
            <i class="fas fa-chart-line text-success"></i>
            <div>
                <h6>Reports</h6>
                <p>Ripoti za kina za kila siku.</p>
            </div>
        </a>

        <a href="{{ url_for('alerts') }}" class="module-card">
            <i class="fas fa-bell text-danger"></i>
            <div>
                <h6>Alerts Center</h6>
                <p>Faults & Active warnings.</p>
            </div>
        </a>

        <a href="{{ url_for('settings') }}" class="module-card">
            <i class="fas fa-sliders-h text-secondary"></i>
            <div>
                <h6>Settings</h6>
                <p>Usimamizi wa mfumo.</p>
            </div>
        </a>
    </div>

    <div class="industrial-box mt-5 mb-5">
        <h6 class="text-muted small fw-bold mb-3 text-uppercase"><i class="fas fa-stream me-2"></i> Real-time Fault Feed</h6>
        <div class="table-responsive">
            <table class="table table-dark table-hover pro-table mb-0">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Unit ID</th>
                        <th>Fault Description</th>
                        <th>Severity</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>14:22:05</td>
                        <td>CAT 336D (MBD02)</td>
                        <td>Boost Pressure Sensor Voltage High</td>
                        <td><span class="badge bg-danger">Critical</span></td>
                        <td><i class="fas fa-spinner fa-spin text-warning me-2"></i> Investigating</td>
                    </tr>
                    <tr>
                        <td>13:10:45</td>
                        <td>D8R (9EM01)</td>
                        <td>Fuel Pressure Intermittent Signal</td>
                        <td><span class="badge bg-warning text-dark">Warning</span></td>
                        <td><i class="fas fa-check-circle text-success me-2"></i> Resolved</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Main Performance Chart
    const ctx1 = document.getElementById('mainChart').getContext('2d');
    new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],
            datasets: [{
                label: 'Actual Hours',
                data: [120, 150, 110, 180, 135],
                backgroundColor: '#FFCD00',
                borderRadius: 5
            }, {
                label: 'Target Hours',
                data: [140, 140, 140, 140, 140],
                type: 'line',
                borderColor: '#00ffcc',
                borderWidth: 2,
                pointRadius: 0,
                fill: false
            }]
        },
        options: {
            plugins: { legend: { labels: { color: '#666' } } },
            scales: {
                y: { grid: { color: '#1a1a1a' }, ticks: { color: '#666' } },
                x: { grid: { display: false }, ticks: { color: '#666' } }
            }
        }
    });

    // Health Distribution Chart
    const ctx2 = document.getElementById('healthChart').getContext('2d');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Electrical', 'Hydraulic', 'Engine', 'Transmission'],
            datasets: [{
                data: [35, 25, 30, 10],
                backgroundColor: ['#00ffcc', '#FFCD00', '#ff4444', '#4444ff'],
                borderWidth: 0
            }]
        },
        options: {
            cutout: '80%',
            plugins: {
                legend: { position: 'bottom', labels: { color: '#888', padding: 20 } }
            }
        }
    });
</script>
{% endblock %}
