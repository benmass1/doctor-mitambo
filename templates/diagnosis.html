{% extends "layout.html" %}
{% block content %}
<div class="ai-container" style="max-width: 800px; margin: 0 auto; padding: 20px;">
    
    <div class="scanner-header shadow-lg text-center p-4 mb-4" style="background: #111; border: 1px solid #00ffcc; border-radius: 20px;">
        <i class="fas fa-robot fa-3x text-success mb-3"></i>
        <h4 class="text-white">AI DIAGNOSIS HALISI</h4>
        <p class="small text-muted">Eleza tatizo la mtambo upate majibu ya Gemini AI</p>
    </div>

    <div class="chat-box mb-4">
        {% if result %}
        <div class="ai-message p-3 mb-3" style="background: #1a1a1a; border-left: 4px solid #00ffcc; border-radius: 10px;">
            <h6 class="text-success fw-bold"><i class="fas fa-check-circle me-2"></i>UCHAMBUZI WA DR. MITAMBO:</h6>
            <p class="text-white small" id="aiResponseText">{{ result }}</p>
            <button onclick="readAloud()" class="btn btn-sm btn-outline-success mt-2">
                <i class="fas fa-volume-up me-1"></i>Sikiliza
            </button>
        </div>
        {% else %}
        <div class="p-3 text-center text-muted border border-secondary rounded">
            <p class="small mb-0">Subiri uchambuzi hapa baada ya kubonyeza ANALYZE...</p>
        </div>
        {% endif %}
    </div>

    <form action="{{ url_for('diagnosis') }}" method="POST">
        <div class="input-group shadow-sm">
            <input type="text" name="error_code" class="form-control bg-dark text-white border-secondary" 
                   placeholder="Andika hapa... (mfano: Moshi mweusi na kukosa nguvu)" required>
            <button type="submit" class="btn btn-success fw-bold">ANALYZE</button>
        </div>
    </form>

</div>

<script>
    function readAloud() {
        const text = document.getElementById("aiResponseText").innerText;
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'sw-TZ';
        window.speechSynthesis.speak(utterance);
    }
</script>
{% endblock %}
