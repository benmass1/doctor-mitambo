here{% extends "layout.html" %}
{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2 class="text-warning"><i class="fas fa-cog me-2"></i> PARTS BOOK</h2>
        <span class="badge bg-secondary">System Online</span>
    </div>

    <div class="row mt-4">
        <div class="col-md-8">
            <div class="card bg-dark border-secondary text-white p-3 mb-4">
                <h5><i class="fas fa-project-diagram me-2 text-info"></i> Exploded View - Hydraulic Pump</h5>
                <hr class="border-secondary">
                <div class="text-center p-4 bg-black rounded">
                    <i class="fas fa-tools fa-5x opacity-25"></i>
                    <p class="mt-3 small opacity-50">Select a component to see part numbers</p>
                </div>
                <div class="mt-3">
                    <table class="table table-dark table-hover small">
                        <thead>
                            <tr>
                                <th>Ref #</th>
                                <th>Part Name</th>
                                <th>Qty</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>01</td>
                                <td>Swash Plate Assembly</td>
                                <td>1</td>
                                <td><button class="btn btn-sm btn-outline-warning">Add to List</button></td>
                            </tr>
                            <tr>
                                <td>02</td>
                                <td>Piston Kit (Set of 9)</td>
                                <td>1</td>
                                <td><button class="btn btn-sm btn-outline-warning">Add to List</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-warning bg-black text-white" style="position: sticky; top: 20px;">
                <div class="card-header bg-warning text-dark fw-bold">
                    <i class="fas fa-robot me-2"></i> PARTS AI ASSISTANT
                </div>
                <div class="card-body">
                    <div id="ai-response-box" class="mb-3" style="height: 300px; overflow-y: auto; font-size: 0.9rem;">
                        <p class="text-info">Habari! Mimi ni msaidizi wako wa vipuri. Unaweza kuniuliza kuhusu:</p>
                        <ul class="opacity-75">
                            <li>Vigezo vya seal kits</li>
                            <li>Ushauri wa torque za engine bolts</li>
                            <li>Tafsiri ya michoro ya kiufundi</li>
                        </ul>
                    </div>
                    <div class="input-group">
                        <input type="text" id="parts-query" class="form-control bg-dark text-white border-secondary" placeholder="Uliza hapa...">
                        <button class="btn btn-warning" onclick="askPartsAI()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function askPartsAI() {
    const query = document.getElementById('parts-query').value;
    const responseBox = document.getElementById('ai-response-box');
    
    if(!query) return;

    responseBox.innerHTML += `<p class="text-warning mt-2"><strong>Wewe:</strong> ${query}</p>`;
    responseBox.innerHTML += `<p class="text-info" id="loading">Inafikiria...</p>`;
    document.getElementById('parts-query').value = '';

    fetch('/api/ask_expert', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({query: query, category: 'parts'})
    })
    .then(res => res.json())
    .then(data => {
        const loader = document.getElementById('loading');
        if(loader) loader.remove();
        responseBox.innerHTML += `<p class="text-light"><strong>AI:</strong> ${data.result}</p>`;
        responseBox.scrollTop = responseBox.scrollHeight;
    })
    .catch(err => {
        responseBox.innerHTML += `<p class="text-danger">Samahani, kuna tatizo la mtandao.</p>`;
    });
}
</script>
{% endblock %}
