{% extends "layout.html" %}
{% block content %}
<style>
    :root { --cat: #FFCD00; --bg: #0a0a0a; --card: #141414; --text-muted: #a0a0a0; }
    body { background-color: var(--bg); color: #fff; font-family: 'Inter', sans-serif; padding-bottom: 80px; }
    
    .header-pro { background: linear-gradient(180deg, #000 0%, #111 100%); padding: 30px 20px; border-bottom: 2px solid var(--cat); }
    
    .search-box { 
        background: #1a1a1a; 
        border: 1px solid #333; 
        border-radius: 50px; 
        padding: 12px 25px; 
        margin-top: -30px; 
        box-shadow: 0 10px 30px rgba(0,0,0,0.6); 
        max-width: 600px;
    }
    .search-box input { background: transparent; border: none; color: white; width: 100%; outline: none; }
    
    .trouble-section { background: var(--card); border-radius: 20px; padding: 25px; margin-bottom: 25px; border: 1px solid #222; }
    .trouble-section h5 { letter-spacing: 1px; }

    .guide-step { border-left: 2px solid var(--cat); padding-left: 25px; position: relative; margin-bottom: 30px; }
    .guide-step::before { 
        content: ''; 
        position: absolute; 
        left: -9px; 
        top: 0; 
        width: 16px; 
        height: 16px; 
        background: var(--cat); 
        border-radius: 50%; 
        border: 4px solid var(--bg); 
    }
    
    .spec-table { width: 100%; font-size: 0.85rem; margin-top: 15px; background: #000; border-radius: 10px; overflow: hidden; border-collapse: collapse; }
    .spec-table th { background: #222; color: var(--cat); padding: 12px; text-align: left; }
    .spec-table td { padding: 12px; border-bottom: 1px solid #111; }
    
    .warning-box { background: rgba(255, 68, 68, 0.1); border: 1px solid #ff4444; color: #ffbbbb; padding: 15px; border-radius: 12px; font-size: 0.85rem; margin: 15px 0; }
    .tech-badge { background: #333; color: var(--cat); padding: 3px 10px; border-radius: 5px; font-family: monospace; font-size: 0.8rem; }
</style>

<div class="header-pro text-center">
    <div class="container d-flex justify-content-between align-items-center mb-3">
        <a href="/" class="text-warning text-decoration-none fw-bold"><i class="fas fa-chevron-left me-1"></i> DASHBOARD</a>
        <span class="badge rounded-pill bg-warning text-dark px-3 py-2">ADVANCED DIAGNOSIS</span>
    </div>
    <h3 class="fw-bold mb-0">TROUBLESHOOTING <span class="text-warning">HUB</span></h3>
    <p class="small text-muted">Miongozo ya hatua kwa hatua ya kutatua hitilafu za mitambo (Site Guides)</p>
</div>

<div class="container">
    <div class="search-box mx-auto d-flex align-items-center">
        <i class="fas fa-search text-warning me-3"></i>
        <input type="text" id="faultSearch" placeholder="Tafuta CID-FMI, Error Code au Tatizo...">
    </div>

    <div class="mt-5">
        <div class="trouble-section">
            <h5 class="fw-bold text-warning mb-4"><i class="fas fa-triangle-exclamation me-2"></i>ENGINE SYSTEM</h5>
            
            <div class="guide-step">
                <h6 class="fw-bold text-white">Tatizo: Injini Kupata Joto (Overheating)</h6>
                <p class="small text-muted">Miongozo kwa injini za Common Rail (CAT C-Series, Komatsu SAA n.k)</p>
                
                <div class="warning-box">
                    <i class="fas fa-skull-crossbones me-2"></i> <strong>ONYO LA USALAMA:</strong> Usifungue kifuniko cha radiator (Radiator Cap) wakati injini ni ya moto. Shinikizo la mvuke linaweza kusababisha majeraha makubwa.
                </div>
                
                <ul class="small opacity-75 list-unstyled">
                    <li class="mb-2"><i class="fas fa-check text-warning me-2"></i><b>Hatua ya 1:</b> Kagua kiwango cha coolant na uvujaji (external leaks).</li>
                    <li class="mb-2"><i class="fas fa-check text-warning me-2"></i><b>Hatua ya 2:</b> Kagua Fan Belt na Hydraulic Fan Speed (ikiwa inatumia fan motor).</li>
                    <li class="mb-2"><i class="fas fa-check text-warning me-2"></i><b>Hatua ya 3:</b> Safisha "Radiator Fins" kwa kutumia hewa au maji ya presha (chini ya 30 psi).</li>
                </ul>

                <div class="table-responsive">
                    <table class="spec-table">
                        <thead><tr><th>Component</th><th>Spec/Tolerance</th><th>Recommended Action</th></tr></thead>
                        <tbody>
                            <tr><td>Radiator Cap</td><td>1.1 Bar (16 PSI)</td><td>Replace if seal is cracked</td></tr>
                            <tr><td>Thermostat</td><td>82Â°C (Opens fully)</td><td>Test in boiling water</td></tr>
                            <tr><td>Engine Load</td><td>80% - 95%</td><td>Downshift if temp rises</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            [attachment_0](attachment)

            <div class="guide-step">
                <h6 class="fw-bold text-white">Tatizo: Black Smoke & Low Power</h6>
                <p class="small text-muted">Uchambuzi wa mchanganyiko wa hewa na mafuta (Air-to-Fuel Ratio).</p>
                <ul class="small opacity-75 list-unstyled">
                    <li class="mb-2"><i class="fas fa-tools text-warning me-2"></i><b>Turbo Check:</b> Kagua uvujaji wa hewa kwenye "Intercooler Hoses".</li>
                    <li class="mb-2"><i class="fas fa-tools text-warning me-2"></i><b>Fuel Check:</b> Badilisha Fuel Filters na pima "Primary Fuel Pressure".</li>
                </ul>
            </div>
        </div>

        <div class="trouble-section">
            <h5 class="fw-bold text-warning mb-4"><i class="fas fa-faucet-drip me-2"></i>HYDRAULIC SYSTEM</h5>
            
            <div class="guide-step">
                <h6 class="fw-bold text-white">Tatizo: Mitambo Kuwa Mizito (Slow Response)</h6>
                <p class="small text-muted">Uchunguzi wa Negative Flow Control (NFC) na Pilot Pressure.</p>
                
                <div class="p-3 bg-dark border border-secondary rounded mb-3">
                    <span class="tech-badge mb-2 d-inline-block">TECHNICAL TEST</span><br>
                    <p class="small mb-0 text-light">Pima voltage kwenye <b>Pump Solenoid (PRV)</b>: 
                    Ikiwa lever iko neutral: <b>0.5V - 1.2V</b>. 
                    Ikiwa lever imeshikwa (full stroke): <b>3.5V - 4.2V</b>.</p>
                </div>

                <ul class="small opacity-75 list-unstyled">
                    <li class="mb-2"><i class="fas fa-wrench text-warning me-2"></i><b>Pilot Pressure:</b> Pima kwenye block ya pilot (Standard: 35-40 Bar).</li>
                    <li class="mb-2"><i class="fas fa-wrench text-warning me-2"></i><b>Main Relief:</b> Kagua Main Relief Valve ikiwa imekwama wazi (Stuck Open).</li>
                </ul>
            </div>
            
            
        </div>

        <div class="trouble-section">
            <h5 class="fw-bold text-warning mb-4"><i class="fas fa-microchip me-2"></i>ELECTRICAL CODES</h5>
            <div class="guide-step">
                <h6 class="fw-bold text-danger">Fault Code: 5V Sensor Supply (Short/Open)</h6>
                <p class="small text-muted">ECM inashindwa kutoa voltaji ya kurejelea (Reference Voltage) kwa sensorer.</p>
                <div class="table-responsive">
                    <table class="spec-table">
                        <thead><tr><th>ECM Pin Out</th><th>Wire Color</th><th>Expected Signal</th></tr></thead>
                        <tbody>
                            <tr><td>Digital Ref +5V</td><td>Red/White</td><td>5.02V Constant</td></tr>
                            <tr><td>Sensor Return</td><td>Black/Yellow</td><td>0.01V - 0.05V</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="fixed-bottom p-3 bg-dark border-top border-secondary text-center">
    <div class="container">
        <button class="btn btn-warning w-100 fw-bold rounded-pill py-3 shadow" onclick="window.print()">
            <i class="fas fa-file-pdf me-2"></i> PAKUA MWONGOZO (PDF)
        </button>
    </div>
</div>

<script>
    // Simple search filter
    document.getElementById('faultSearch').addEventListener('keyup', function() {
        let filter = this.value.toUpperCase();
        let sections = document.querySelectorAll('.trouble-section');
        
        sections.forEach(section => {
            let text = section.innerText.toUpperCase();
            section.style.display = text.includes(filter) ? "" : "none";
        });
    });
</script>
{% endblock %}
